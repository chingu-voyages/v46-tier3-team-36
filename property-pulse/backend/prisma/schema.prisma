generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     Int            @id @default(autoincrement())
  name                   String
  password               String?
  email                  String         @unique
  emailVerified          DateTime?
  image                  String?
  role                   Role           @default(tenant)
  issues                 Issue[]
  notifications          Notification[]

  // tenants
  residence              Unit[]

  // managers
  properties             Property[]   @relation("Properties")
}

model Session {
  sid                   String   @id @db.VarChar
  sess                  Json     @db.Json
  expire                DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
  @@map(name: "session")
}

enum Role {
  manager
  tenant
}

// Should issues be associated with tenant only, or manager too?
model Issue {
  id              Int              @id @default(autoincrement())
  status          IssueStatus      @default(open)
  type            IssueType
  tenant          User             @relation(fields: [tenantId], references: [id])
  tenantId        Int
  createdAt       DateTime         @default(now()) @db.Timestamptz()
  updatedAt       DateTime         @updatedAt
  title           String
  description     String
}

enum IssueStatus {
  open
  closed
}

enum IssueType {
  maintenanceRequest
  complaint
  inquiry
}

model Notification {
  id              Int              @id @default(autoincrement())
  user            User             @relation(fields: [userId], references: [id])
  userId          Int
  createdAt       DateTime         @default(now()) @db.Timestamptz()
  title           String
  content         String
  read            Boolean          @default(false)
  isNew           Boolean          @default(true)
}

// Should both properties and units have tenants or just a property has units that has tenants?
model Property {
  id              Int              @id @default(autoincrement())
  owner           User    @relation(fields: [ownerId], references: [id], name: "Properties")
  ownerId         Int 
  name            String
  description     String?
  units           Unit[]
}

model Unit {
  id              Int              @id @default(autoincrement())
  property        Property         @relation(fields: [propertyId], references: [id])
  propertyId      Int
  tenants         User[]
  name            String
  description     String?
  rent            Decimal          @db.Decimal(10,2)
}



// model Message {

// }

// model Bill {

// }